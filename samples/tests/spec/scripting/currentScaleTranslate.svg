<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN"
"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">

<!-- ====================================================================== -->
<!-- Copyright (C) The Apache Software Foundation. All rights reserved.     -->
<!--                                                                        -->
<!-- This software is published under the terms of the Apache Software      -->
<!-- License version 1.1, a copy of which has been included with this       -->
<!-- distribution in the LICENSE file.                                      -->
<!-- ====================================================================== -->

<!-- ====================================================================== -->
<!-- append child test                                                      -->
<!--                                                                        -->
<!-- @author tkormann@ilog.fr                                               -->
<!-- @version $Id$ -->
<!-- ====================================================================== -->

<?xml-stylesheet type="text/css" href="../../resources/style/test.css" ?>  

<svg id="body" width="450" height="500" viewBox="0 0 450 500"
     onload="setScaleTrans(2, 50, 50), update()"
     xmlns="http://www.w3.org/2000/svg" 
     xmlns:xlink="http://www.w3.org/1999/xlink">

    <title>svg current scale/translate modification</title>

    <script type="text/ecmascript"><![CDATA[
	var count = 1;
	function setScaleTrans(scale, newX, newY) {
	   document.getRootElement().currentScale = scale;
	   var pt = document.getRootElement().currentTranslate;
	   pt.x = newX;
	   pt.y = newX;
	}
	 
	function update() {
	   if ((count%10) == 0) {
	      var scale = 1+((count/10)%10)/4;
              document.getRootElement().currentScale = scale;
	   }

	var t;
	var mat;
           t = document.getElementById('cnt');
	   t.firstChild.data = ("Count: " + count);

	   mat = t.getScreenCTM();
           t = document.getElementById('foo');
	   t.firstChild.data = 
	       "The ScrnCTM is: (" + mat.a +","+ mat.b +","+ mat.c +","+ mat.d +","+ mat.e +","+ mat.f +")";

	   mat = t.getCTM();
           t = document.getElementById('bar');
	   t.firstChild.data = 
	       "The CTM is: (" + mat.a +","+ mat.b +","+ mat.c +","+ mat.d +","+ mat.e +","+ mat.f +")";

	   var scale = document.getRootElement().currentScale;
           t = document.getElementById('baz');
	   t.firstChild.data = "The Scale is: "+scale;

	   var trans = document.getRootElement().currentTranslate;
           t = document.getElementById('bat');
	   t.firstChild.data = "The Trans is ["+trans.x+", " +trans.y+"]";

           t = document.getElementById('vp');
	   var vp = document.rootElement.viewport;
	   t.firstChild.data = ("Viewport: ["+ vp.x+", " +vp.y+", " +
	                        vp.width+", " +vp.height+"]");

	   count++;
	  setTimeout('update()', 1000);
	}

	function mouseOver(evt) {
	   t = document.getElementById('rec');
	   var x = evt.getClientX();
	   var y = evt.getClientY();
	   mat = t.getScreenCTM();
	   imat = mat.inverse();
	   var pt = document.getRootElement().createSVGPoint();
 	   pt.x = x;
	   pt.y = y;
	   pt = pt.matrixTransform(imat);
	   t.firstChild.data = ("Loc: [" + evt.getClientX() + ", " + 
	                        evt.getClientY() + "] [" + 
	                        pt.x + ", " + pt.y + "]");
	}
    ]]></script>

    <g id="test-content">
       <rect x="0" y="0" width="450" height="500" 
             fill="lightgrey" stroke="black"
             onmousemove="mouseOver(evt)"/>
       <text id="cnt" x="10" y=" 80">test</text>
       <text id="foo" x="10" y="100">test</text>
       <text id="bar" x="10" y="120">test</text>
       <text id="baz" x="10" y="140">test</text>
       <text id="bat" x="10" y="160">test</text>
       <text id="vp"  x="10" y="180">test</text>
       <text id="rec" x="10" y="200">test</text>
   </g>
</svg>